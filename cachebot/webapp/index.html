<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BC Cash</title>
    <link rel="stylesheet" href="/app/styles.css?v=pay20" />
  </head>
  <body>
    <div id="app">
      <header class="topbar">
        <div class="brand">
          <img class="brand-mark" src="/app/assets/bc-logo.png" alt="BC Cash" />
        </div>
        <div class="topbar-actions">
          <button id="themeToggle" class="theme-switch" type="button" aria-pressed="false">
            <span class="theme-switch-track">
              <span class="theme-switch-thumb">
                <span class="theme-switch-icon">☀️</span>
              </span>
            </span>
            <span class="theme-switch-label">День</span>
          </button>
          <button id="profileQuick" class="profile-chip">
            <span class="profile-avatar" id="profileAvatar">BC</span>
            <span class="profile-name" id="profileNameTop">Гость</span>
          </button>
        </div>
      </header>

      <nav class="tabs">
        <button class="tab nav-btn" data-view="p2p">P2P</button>
        <button class="tab nav-btn" data-view="deals">Сделки</button>
        <button class="tab nav-btn" data-view="profile">Профиль</button>
        <button class="tab nav-btn" data-view="support">Поддержка</button>
        <div class="tabs-extra">
          <button class="tab nav-btn" data-view="disputes" id="disputesTab">Споры</button>
          <button class="tab nav-btn" data-view="admin" id="adminTab">Админ</button>
        </div>
      </nav>

      <section class="panel view active" id="view-profile">
        <div class="panel-header">
          <h2>Профиль</h2>
          <span id="userBadge" class="badge">Гость</span>
        </div>
        <div class="profile-hero">
          <div class="profile-avatar-large" id="profileAvatarLarge">BC</div>
          <div>
            <div id="profileDisplayName" class="profile-value">—</div>
          </div>
          <button id="profileEditOpen" class="btn ghost">Изменить</button>
        </div>
        <div class="profile-grid">
          <div class="profile-card">
            <div class="profile-title">Данные</div>
            <div id="profileName" class="profile-value">—</div>
            <div id="profileUsername" class="profile-muted">—</div>
            <div id="profileRegistered" class="profile-muted">—</div>
          </div>
          <div class="profile-card" id="profileRoleCard">
            <div class="profile-title">Роль</div>
            <div id="profileRole" class="profile-value">—</div>
            <div id="profileMerchantSince" class="profile-muted">—</div>
          </div>
          <div class="profile-card">
            <div class="profile-title">Баланс</div>
            <div class="profile-balance-row">
              <div id="profileBalance" class="profile-value">—</div>
              <button id="profileWithdraw" class="btn pill">Вывести</button>
              <button id="topupOpen" class="btn pill">Пополнить</button>
            </div>
            <div class="profile-muted">USDT</div>
          </div>
          <div class="profile-card" id="profileStatsCard">
            <div class="profile-title">Статистика</div>
            <div id="profileDealsTotal" class="profile-value">Сделок: —</div>
            <div id="profileDealsSuccess" class="profile-muted">Успешные: —%</div>
            <div id="profileDealsFailure" class="profile-muted">Неуспешные: —%</div>
            <div id="profileReviewsCount" class="profile-muted">Отзывы: —</div>
          </div>
        </div>
        <div class="profile-actions">
          <button id="reviewsOpen" class="btn pill">Отзывы</button>
        </div>
      </section>

      <section class="panel view" id="view-deals">
        <div class="panel-header">
          <h2>Сделки</h2>
          <span id="dealsCount" class="badge">0</span>
        </div>
        <div id="dealsList" class="deal-list"></div>
        <div id="dealsPagination" class="deal-pagination"></div>
      </section>

      <section class="panel view" id="view-p2p">
        <div class="panel-header">
          <h2>P2P Маркет</h2>
          <span id="p2pTradingBadge" class="badge">—</span>
        </div>
        <div class="p2p-toolbar">
          <button id="p2pBuyBtn" class="btn primary">Купить</button>
          <button id="p2pSellBtn" class="btn">Продать</button>
          <button id="p2pMyAdsBtn" class="btn">Объявления</button>
        </div>
        <div class="p2p-actions">
          <button id="p2pCreateBtn" class="btn">Создать объявление</button>
          <button id="p2pTradingToggle" class="btn ghost">Торги: —</button>
        </div>
        <div id="p2pList" class="deal-list"></div>
      </section>

      <section class="panel view" id="view-support">
        <div class="panel-header">
          <h2>Поддержка</h2>
        </div>
        <div class="panel-body">
          <div class="support-card">
            <div class="support-title">Нужна помощь?</div>
            <div class="support-text">Опиши проблему — мы ответим как можно быстрее.</div>
            <button class="btn ghost">Написать в поддержку</button>
          </div>
        </div>
      </section>

      <section class="panel view" id="view-disputes">
        <div class="panel-header">
          <h2>Спорные ситуации</h2>
          <span id="disputesCount" class="badge">0</span>
        </div>
        <div id="disputesList" class="deal-list"></div>
      </section>

      <section class="panel view" id="view-admin">
        <div class="panel-header">
          <h2>Админ панель</h2>
          <span class="badge">Управление</span>
        </div>
        <div class="admin-grid">
          <div class="admin-card">
            <div class="profile-title">Управление ценой</div>
            <label>Курс USDT/RUB
              <input id="adminRate" type="number" step="0.01" />
            </label>
            <label>Комиссия пополнения (%)
              <input id="adminFee" type="number" step="0.01" />
            </label>
            <label>Комиссия на вывод (%)
              <input id="adminWithdrawFee" type="number" step="0.01" />
            </label>
            <button id="adminSaveRates" class="btn primary">Сохранить</button>
          </div>
          <div class="admin-card">
            <div class="profile-title">Модераторы</div>
            <div class="admin-row">
              <input id="adminModeratorUsername" placeholder="@username" />
              <button id="adminAddModerator" class="btn">Добавить</button>
            </div>
            <div id="adminModerators" class="admin-list"></div>
          </div>
          <div class="admin-card">
            <div class="profile-title">Мерчанты</div>
            <div id="adminMerchants" class="admin-list"></div>
          </div>
        </div>
      </section>

      <section class="panel" id="systemPanel">
        <div class="panel-header">
          <h2>Системные сообщения</h2>
          <span class="badge">Лог</span>
        </div>
        <div id="log" class="log"></div>
      </section>
    </div>
      <div class="modal" id="dealModal">
        <div class="modal-card">
          <div class="modal-header">
            <div id="dealModalTitle" class="modal-title">Сделка</div>
            <button id="dealModalClose" class="btn ghost">Закрыть</button>
          </div>
          <div id="dealModalBody" class="modal-body"></div>
          <div id="dealModalActions" class="modal-actions"></div>
          <div class="modal-note">
            Для отправки QR используйте бот. В WebApp доступны подтверждения и управление.
          </div>
        </div>
      </div>

      <div class="modal" id="p2pModal">
        <div class="modal-card">
          <div class="modal-header">
            <div id="p2pModalTitle" class="modal-title">Объявление</div>
            <button id="p2pModalClose" class="btn ghost">Закрыть</button>
          </div>
          <div id="p2pModalBody" class="modal-body"></div>
          <div id="p2pModalActions" class="modal-actions"></div>
        </div>
      </div>

      <div class="modal" id="p2pCreateModal">
        <div class="modal-card">
          <div class="modal-header">
            <div class="modal-title">Новое объявление</div>
            <button id="p2pCreateClose" class="btn ghost">Закрыть</button>
          </div>
          <form id="p2pCreateForm" class="p2p-form">
            <label>Сторона
              <select id="p2pSide">
                <option value="sell">Продать USDT</option>
                <option value="buy">Купить USDT</option>
              </select>
            </label>
            <label>Объем (USDT)
              <div class="p2p-input-row">
                <input id="p2pVolume" type="number" step="0.001" min="0" placeholder="Например: 100" />
                <button type="button" id="p2pVolumeMax" class="btn ghost">Макс объем</button>
              </div>
              <div class="p2p-hint" id="p2pBalanceHint">Баланс: —</div>
            </label>
            <label>Цена за 1 USDT (RUB)
              <input id="p2pPrice" type="number" step="0.01" min="0" placeholder="Например: 74" />
            </label>
            <label>Лимиты RUB
              <input id="p2pLimits" type="text" placeholder="1000-10000" />
              <div class="p2p-hint">Формат: минимум-максимум</div>
            </label>
            <label>Банки
              <div id="p2pBanks" class="p2p-banks"></div>
            </label>
            <label>Условия сделки
              <textarea id="p2pTerms" rows="3" placeholder="Опционально"></textarea>
            </label>
            <button type="submit" class="btn primary">Создать</button>
          </form>
        </div>
      </div>

      <div class="modal" id="profileModal">
        <div class="modal-card">
          <div class="modal-header">
            <div class="modal-title">Профиль</div>
            <button id="profileModalClose" class="btn ghost">Закрыть</button>
          </div>
          <div class="modal-body">
            <div id="profileQuickName" class="profile-value">—</div>
            <div id="profileQuickUsername" class="profile-muted">—</div>
          </div>
          <div class="modal-actions">
            <button id="profileGo" class="btn primary">Перейти в профиль</button>
          </div>
        </div>
      </div>

      <div class="modal" id="profileEditModal">
        <div class="modal-card">
          <div class="modal-header">
            <div class="modal-title">Редактировать профиль</div>
            <button id="profileEditClose" class="btn ghost">Закрыть</button>
          </div>
          <form id="profileEditForm" class="p2p-form">
            <label>Имя
              <input id="profileEditName" type="text" maxlength="32" placeholder="Введите имя" />
            </label>
            <label>Аватар
              <div class="profile-edit-row">
                <input id="profileEditAvatar" type="file" accept="image/*" />
                <div class="profile-avatar-preview" id="profileEditPreview">BC</div>
              </div>
            </label>
            <button type="submit" class="btn primary">Сохранить</button>
          </form>
        </div>
      </div>

      <div class="modal" id="sellModal">
        <div class="modal-card">
          <div class="modal-header">
            <div class="modal-title">Продать USDT</div>
            <button id="sellModalClose" class="btn ghost">Закрыть</button>
          </div>
          <form id="sellForm" class="p2p-form">
            <label>Сумма в RUB
              <input id="sellAmount" type="number" step="0.01" min="0" placeholder="Например: 5000" />
            </label>
            <button type="submit" class="btn primary">Создать сделку</button>
          </form>
        </div>
      </div>

      <div class="modal" id="topupModal">
        <div class="modal-card">
          <div class="modal-header">
            <div class="modal-title">Пополнение баланса</div>
            <button id="topupClose" class="btn ghost">Закрыть</button>
          </div>
          <form id="topupForm" class="p2p-form">
            <label>Сумма в USDT
              <input id="topupAmount" type="number" step="0.001" min="0" placeholder="Например: 50" />
            </label>
            <button type="submit" class="btn primary">Оплатить</button>
          </form>
        </div>
      </div>

      <div class="modal" id="withdrawModal">
        <div class="modal-card">
          <div class="modal-header">
            <div class="modal-title">Вывод USDT</div>
            <button id="withdrawClose" class="btn ghost">Закрыть</button>
          </div>
          <form id="withdrawForm" class="p2p-form">
            <label>Сумма в USDT (минимум 1.5)
              <input id="withdrawAmount" type="number" step="0.001" min="0" placeholder="Например: 20" />
            </label>
            <button type="submit" class="btn primary">Вывести</button>
          </form>
        </div>
      </div>

      <div class="modal" id="reviewsModal">
        <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Отзывы</div>
          <button id="reviewsClose" class="btn ghost">Закрыть</button>
        </div>
        <div class="reviews-tabs" data-active="all">
          <span class="tab-indicator" aria-hidden="true"></span>
          <button class="btn tab-btn active" data-tab="all">Все</button>
          <button class="btn tab-btn" data-tab="positive">Плюс</button>
          <button class="btn tab-btn" data-tab="negative">Минус</button>
        </div>
          <div id="reviewsSummary" class="reviews-summary">—</div>
          <div id="reviewsList" class="deal-list"></div>
          <div id="reviewsPagination" class="reviews-pagination"></div>
        </div>
      </div>

    <div id="successAnim" class="success-anim" aria-hidden="true"></div>
    <div id="centerNotice" class="center-notice" aria-live="polite"></div>

    <script src="/app/assets/lottie.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/app/app.js?v=pay20"></script>
  </body>
</html>
